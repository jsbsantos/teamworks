@using Teamworks.Web.Helpers.Extensions.Mvc
@model Teamworks.Web.ViewModels.Mvc.ActivityViewModel

@{
    ViewBag.Title = Model.Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <ul class="breadcrumb span12">
        <li>
            <a href="@Url.RouteUrl("default", new {controller = "Projects", action = "View", id = UrlParameter.Optional})">Projects</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a data-bind="text: projectReference.name, href: '@Url.RouteUrl("default", new {controller = "Projects", action = "Details", id = UrlParameter.Optional})' + projectReference.id() ">@Model.ProjectReference.Name</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a data-bind="href: '@Url.RouteUrl("activities", new {controller = "Activities", action = "View", projectId = Model.ProjectReference.Id, activityId = UrlParameter.Optional})'">Activities</a>
            <span class="divider">/</span>
        </li>
        <li>
            <span data-bind="text: name">@Model.Name</span>
        </li>
    </ul>
</div>

<div class="row">
    <div class="span12">
        <header class="page-header">
            <h1>
                <span data-bind="text: name">@Model.Name</span>
                <small>
                    <span data-bind="text: description, visible: description">
                        @Model.Description
                    </span>
                    <i class="icon-edit"></i> 
                </small>
            </h1>
        </header>
    </div>
</div>


<div>
    <div class="row">
        <h3>Status</h3>
        <div class="span4">
            <div><strong>Start Date:</strong> <span data-bind="text: startDate"></span>
                <i class="icon-edit"></i> 
            </div>
            <div><strong>Duration:</strong> <span data-bind="text: duration"></span>
                <i class="icon-edit"></i> 
            </div>
        </div>
        <div class="span4">
            <div><strong>Total logged time:</strong> <span data-bind="text: totalTimeLogged"></span> <span data-bind="text: '(' + completionPercent() +'%)'"></span></div>
        </div>
    
    <div class="span12 pull-down">
        <h4>Dependencies</h4>

        <!-- ko if: dependencies.length -->
        <div class="span12" >No dependencies.</div>
        <!-- /ko -->

        <!-- ko if: !dependencies.length -->
        <ul class="unstyled" data-bind="template: { name: 'depedency-template', foreach: dependencies }"></ul>
        <!-- /ko -->

        <script type="text/html" id="depedency-template">
            <li>
                <strong data-bind="text: name"></strong>, <small data-bind="text: description"></small>
                (Start: <small data-bind="text: startDate"></small>, Duration: <small data-bind="text: duration"></small>)
            </li>
        </script>
    </div>
</div>
    </div>


<div>
    <header class="lead">Time log for this activity.</header>
    
    <table class="table table-striped table-bordered table-condensed">
        <thead>
            <tr>
                <th>Duration</th>
                <th>Description</th>
                <th>Date</th>
                <th>Person</th>
            </tr>
        </thead>
        <tbody data-bind="template: { name: 'timelog-template', foreach: timelogs }">
        </tbody>
    </table>
    <script type="text/html" id="timelog-template">
        <tr>
            <td data-bind="text: duration"></td>
            <td data-bind="text: description"></td>
            <td data-bind="text: date"></td>
            <td><a data-bind="text: person.name(), href: '@Url.RouteUrl("default", new {controller = "Profiles", action = "View"})/' + id()"></a></td>
        </tr>
    </script>
</div>

<script>
    var viewmodel = function() {
        return tw.pages.ActivityViewModel('/api/projects/@Model.ProjectReference.Id/activities', @Html.ToJson(Model));
    }
</script>

<section>
    <h1>Results</h1>
    <pre>
    @ViewsExtensions.ToIndentedJson(Html, ViewBag.Results)
</pre>
</section>

