@model dynamic
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="chart"></div>

<div class="row">
    <div class="span9">
        <div>
            <ul class="breadcrumb">
                <li>
                    <a href="@Url.RouteUrl("default", new {controller = "Projects"})">Projects</a>
                    <span class="divider">/</span>
                </li>
                <li>
                    <span data-bind="text: project.name"></span>
                </li>
            </ul>
        </div>
        <header class="lead">
            <h1>
                <span data-bind="text: project.name"></span>
                <small> <i class="icon-edit"></i> <span data-bind="text: project.description, visible: project.description"></span></small>
            </h1>
        </header>
        <!-- Activities -->
        <section>
            <div class="page-header">
                <h2>Activities 
                    <small>
                        <a class="hide btn-mini" data-bind="css: { hide: project.activity.editing()}, click: function() { project.activity.editing(true); }">One more activity</a>
                    </small>
                </h2>
                <div class="hide" data-bind="css: { hide: !project.activity.editing() }">
                    <form class="well form-inline" data-bind="submit: project.activities._create">
                        <input id="activity_name" name="activity_name" class="span4" autofocus="autofocus" placeholder="Activity name" data-bind="value: project.activity.name, valueUpdate: 'afterkeyup'" />
                        <button type="submit" class="btn btn-success">Create</button>  
                        <a class="btn-mini" data-bind="click: function() { project.activity.editing(false) }"><i class="icon-remove"></i></a>                   
                    </form>
                </div>
            </div>
            <!-- ko template: { name: 'activities-template', foreach: project.activities } -->
            <!-- /ko -->
            <script type="text/html" id="activities-template">
                <div>
                    <button class="close" data-bind="click: $parent.project.activities._remove">&times;</button>
                    <h3>
                        <a data-bind="attr: { href: '/projects/' + $parent.project.id() + '/activities/' + id() }">
                            <span data-bind="text: name"></span>
                            <small data-bind="text: description"></small>
                        </a>
                    </h3>
                </div>
            </script>
        </section>
        <section>
            <div class="page-header">
                <h2>Discussion
                    <small>
                        <a class="hide btn-mini" data-bind="css: { hide: project.discussion.editing()}, click: function() { project.discussion.editing(true); }">One more discussion</a>
                    </small>
                </h2>
                <div class="hide" data-bind="css: { hide: !project.discussion.editing() }">
                    <form class="well form-inline" data-bind="submit: project.discussions._create">
                        <input id="discussion_name" name="discussion_name" class="span4" autofocus="autofocus" placeholder="Discussion name" data-bind="value: project.discussion.name, valueUpdate: 'afterkeyup'" />
                        <button type="submit" class="btn btn-success">Create</button>  
                        <a class="btn-mini" data-bind="click: function() { project.discussion.editing(false) }"><i class="icon-remove"></i></a>                   
                    </form>
                </div>
            </div>
            <!-- ko template: { name: 'discussion-template', foreach: project.discussions } -->
            <!-- /ko -->
            <!--
            <div class="more-options">To create a new discussion you can send an email to  
                <a id="email_discussion" target="_blank" data-bind="attr: { href: 'mailto:' + project.token() }">
                    an email created just for you
                </a>
                <i class="icon-copy"></i>
            </div>
            -->
            <script type="text/html" id="discussion-template">
                <div>
                    <button class="close" data-bind="click: $parent.project.discussions._remove">&times;</button>
                    <h3>
                        <a data-bind="text: name, attr: { href: '/projects/' + $parent.project.id() + '/discussions/' + id() }"></a>
                    </h3>
                    <p data-bind="text: content"></p>
                </div>
            </script>
        </section>
    </div>
    <div class="span3">
        <h2>People</h2>
        <div class="people">
            <ul class="thumbnails" data-bind="template: { name: 'person-template', foreach: project.people }"></ul>
            <a href="#" class="more-options" data-bind="visible: !project.person.editing(), click: function() { project.person.editing(true); }" >More members</a>
            <div class="hide" data-bind="css: { hide: !project.person.editing() }">
                <form class="form-horizontal" data-bind="submit: project.people._add">
                    <input autocomplete="off" placeholder="Who do you wanto to add" 
                          data-items="4" class="span2" data-bind="value: project.person.text, valueUpdate: 'afterkeyup', typeahead: project.people.typeahead" />
                    <a class="btn-mini" data-bind="click: function() { project.person.editing(false) }"><i class="icon-remove"></i></a> 
                </form>
            </div>
        </div>
        
        <script type="text/html" id="person-template">
            <li class="dropdown">
                <a class="thumbnail dropdown-toggle" data-toggle="dropdown" rel="tooltip-top" data-bind="attr: { href: '#', 'title': name }">
                    <img data-bind="attr: { src: gravatar() + '&s=64' }" />
                </a>               
                <ul class="dropdown-menu well-mini">
                    <img class="pull-left" data-bind="attr: { src: gravatar() + '&s=64' }" />
                    <div>
                        <p data-bind="text: username"></p>
                        <h3><a data-bind="text: name"></a></h3>
                        <p data-bind="text: email"></p>
                        <a class="btn pull-right pull-down" href="#" data-bind="click: $parent.project.people._remove">Remove</a>
                    </div>
                </ul>
            </li>
        </script>
        <br/>
        <h2>Actions</h2>
    </div>
</div>

<script>
    var viewmodel = function() {
        return new TW.viewmodels.Project('@ViewBag.Endpoint');
    };
</script>