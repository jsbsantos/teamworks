@using Teamworks.Web.Views
@model Teamworks.Web.ViewModels.Api.DiscussionViewModel

@{
    Layout = "../Shared/_Layout.cshtml";
}

<div>
    <header class="page-header">
        <h1>@Model.Name</h1>
        <p>@Model.Content</p>
    </header>
    <div data-bind="template: { name: 'message-template', foreach: discussion.messages }">
    </div>
    
    <div class="row">
        <div class="span6">
            <form class="form-horizontal" data-bind="submit: discussion.message._create">
                <div class="control-group">
                    <textarea class="span6" data-bind="value: discussion.message.content, valueUpdate: 'afterkeyup'"></textarea>
                </div>
                <div class="control-group">
                    <button type="submit" class="btn btn-success">Reply</button>                 
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/html" id="message-template">
    <div class="row">
        <div class="span6">
            <div class="well">
                <small> @@ <span data-bind="text: date"></span></small>
                <p data-bind="text: content"></p>
            </div>
        </div>
    </div>
</script>
    
<script>
    var viewmodel = function() {
        return new tw.viewmodels.DiscussionViewModel(@Html.ToJson(Model));
    }
</script>